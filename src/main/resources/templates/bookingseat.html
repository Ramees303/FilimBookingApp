<!doctype html>
<html lang="en" xmlns="https://www.thymeleaf.com">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="/css/home.css" rel="stylesheet" type="text/css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  </head>
  <body>
    
    <!-- coding starting -->
    
       <!-- using fragments for navbar -->
      
 <div th:replace="~{navbar::nav}"></div>
 
      <!-- using fragments for navbar -->
    
    

     <!-- booking section coding started    -->

    <section class="booking pt-5">

       <div class="container  text-center ">


        
        
           
            <h2>Book  seat</h2>
            
            
             <form   th:action="@{/bookingseat}" method="post"  id="myform">
            
               <input type="hidden"  class="form-control" id="senddateform" name="date">
                 
              <input type="hidden"  id="sendtimeform" name="time">
            
               <input type="hidden" id="sendmovieform" name="moviename" >
            
            
            </form>
            
            
        
            <form th:action="@{/savebookingseat{bookid}(bookid=${bookingid}) }" method="post"> 
			 

              <!--used to store the data and sent to server-->
                  <input type="text"  class="form-control" id="totalpricetosend" name="totalprice" style="display: none;">  
                   <input type="text"  class="form-control" id="seatbookedtosend" name="seatbooked" style="display: none;"> 
              <!--used to store the data and sent to server-->   
              <div class="container d-flex">
              <div class="col-md-6 m-2 p-2 border border-white shadow">
                <h3 class="mb-3">Show</h3>
                
               <input type="hidden" id="senddate"  th:value="${date}">
              
              <div class="mb-3 ">
                <label for="movieid" class="form-label" >Movie</label>
                 <input type="text"  class="form-control" id="formmoviename" th:value="${moviename}">
              </div>
              
               
               
                 
              
              
              <div class="mb-3 ">
                  <label for="securityquestion" class="form-label">Time</label>
                  <select class="form-select" aria-label="Default select example" id="formtime" name="time">
                      <option selected th:text="${time}"></option>
                            <option value="09:00 am">09:00 am</option>
							<option value="12:00 am">12:00 am</option>
							<option value="03:00 pm">03:00 pm</option>
							<option value="06:00 pm">06:00 pm</option>
							<option value="09:00 pm">09:00 pm</option>
                    </select>
                </div>
                     
                
              </div>

              <div class="col-md-6 m-2 p-2 border border-white shadow">
                <h3 class="mb-3">Seat </h3>
                
              <div class="mb-3 ">
                
                <span style="font-size: 1.2rem;">Seat Selected :</span>
                 <span id="seatselected" style="font-size: 1.2rem;"></span>
              </div>
            
              <div class="mb-3 ">
                  
                <span style="font-size: 1.2rem;">Price :</span>
                <span id="totalprice"style="font-size: 1.2rem;"></span>
                </div>
              </div>

            </div>


            
              
            <div class="mb-3 mt-5 col-md-3 ">
              <button type="button" class="btn btn-success  disabled me-1" value="seat-4">Not Available</button>
              <button type="button" class="btn btn-success  ms-1" value="seat-5">Available</button>
            </div>

           <div class="container p-8 mt-5">

            

            <div class="row">
            
                 <div class="col-md-3">

              <div >
                <button type="button"   class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-1')}?'disabled':''" value="seat-1" name="seat-1">1</button>
                <button type="button"  class="btn btn-success seat"  th:classappend="${#lists.contains(seatlist,'seat-2')}?'disabled':''"  value="seat-2" name="seat-2" >2</button>
                <button type="button"  class="btn btn-success seat"  th:classappend="${#lists.contains(seatlist,'seat-3')}?'disabled':''" value="seat-3">3</button>
                <button type="button" class="btn btn-success seat"   th:classappend="${#lists.contains(seatlist,'seat-4')}?'disabled':''"value="seat-4">4</button>
                <button type="button" class="btn btn-success seat"   th:classappend="${#lists.contains(seatlist,'seat-5')}?'disabled':''"value="seat-5">5</button>

                <button type="button" id="seat" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-6')}?'disabled':''"  value="seat-6" >6</button>
                <button type="button" id="seat" class="btn btn-success seat"  th:classappend="${#lists.contains(seatlist,'seat-7')}?'disabled':''" value="seat-7" >7</button>
                <button type="button" id="seat" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-8')}?'disabled':''" value="seat-8">8</button>
                <button type="button" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-9')}?'disabled':''" value="seat-9">9</button>
                <button type="button" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-10')}?'disabled':''" value="seat-10">10</button>
                 
                
              </div>
            </div>


            <div class="col-md-3">
              
              <div >
                <button type="button"  class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-11')}?'disabled':''" value="seat-11" name="seat-11">11</button>
                <button type="button"  class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-12')}?'disabled':''"  value="seat-12" name="seat-12" >12</button>
                <button type="button"  class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-13')}?'disabled':''" value="seat-13">13</button>
                <button type="button" class="btn btn-success seat " th:classappend="${#lists.contains(seatlist,'seat-14')}?'disabled':''" value="seat-14">14</button>
                <button type="button" class="btn btn-success seat"  th:classappend="${#lists.contains(seatlist,'seat-15')}?'disabled':''"value="seat-15">15</button>

                <button type="button" id="seat" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-16')}?'disabled':''" value="seat-16" >16</button>
                <button type="button" id="seat" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-17')}?'disabled':''" value="seat-17" >17</button>
                <button type="button" id="seat" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-18')}?'disabled':''" value="seat-18">18</button>
                <button type="button" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-19')}?'disabled':''" value="seat-19">19</button>
                <button type="button" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-20')}?'disabled':''" value="seat-20">20</button>
                 
                
              </div>
              

            </div>

             <div class="col-md-3">

              <div >
                <button type="button"  class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-21')}?'disabled':''" value="seat-21" name="seat-1">21</button>
                <button type="button"  class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-22')}?'disabled':''"  value="seat-22" name="seat-2" >22</button>
                <button type="button"  class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-23')}?'disabled':''"value="seat-23">23</button>
                <button type="button" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-24')}?'disabled':''" value="seat-24">24</button>
                <button type="button" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-25')}?'disabled':''"value="seat-25">25</button>

                <button type="button" id="seat" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-26')}?'disabled':''" value="seat-26" >26</button>
                <button type="button" id="seat" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-27')}?'disabled':''" value="seat-27" >27</button>
                <button type="button" id="seat" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-28')}?'disabled':''" value="seat-28">28</button>
                <button type="button" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-29')}?'disabled':''" value="seat-29">29</button>
                <button type="button" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-30')}?'disabled':''" value="seat-30">30</button>
                 
                
              </div>
              

            </div>


            <div class="col-md-3">

              <div >
                <button type="button"  class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-31')}?'disabled':''" value="seat-31" name="seat-1">31</button>
                <button type="button"  class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-32')}?'disabled':''" value="seat-32" name="seat-2" >32</button>
                <button type="button"  class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-33')}?'disabled':''" value="seat-33">33</button>
                <button type="button" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-34')}?'disabled':''" value="seat-34">34</button>
                <button type="button" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-35')}?'disabled':''" value="seat-35">35</button>

                <button type="button" id="seat" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-36')}?'disabled':''" value="seat-36" >36</button>
                <button type="button" id="seat" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-37')}?'disabled':''" value="seat-37" >37</button>
                <button type="button" id="seat" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-38')}?'disabled':''" value="seat-38">38</button>
                <button type="button" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-39')}?'disabled':''" value="seat-39">39</button>
                <button type="button" class="btn btn-success seat" th:classappend="${#lists.contains(seatlist,'seat-40')}?'disabled':''"value="seat-40">40</button>
                 
                
              </div>

            </div>

            </div>

            </div>

              <button type="submit" id="send" class="btn btn-primary mt-5">Submit</button>
            </form>
            
        </div>

       </div>
    </section>








    <script>

      // variables

     let sum=0
     let price=190
     let seat=[]
     let valuetoSend={}

    //logic for showing booked seat for moviechange and time started
    
      let datetosend=document.getElementById("senddate")
      document.getElementById("senddateform").value=datetosend.value
      
     let sendmovie= document.getElementById("formmoviename")
     document.getElementById("sendmovieform").value=sendmovie.value
     sendmovie.onchange=(e)=>{
		 
          document.getElementById("senddateform").value=datetosend.value
		  document.getElementById("sendmovieform").value=sendmovie.value
		  
		 
       document.forms["myform"].submit();
	  }
                  

     let sendtime=document.getElementById("formtime")
     document.getElementById("sendtimeform").value=sendtime.value
     sendtime.onchange=function(e){
		   document.getElementById("senddateform").value=datetosend.value
		 document.getElementById("sendtimeform").value=sendtime.value
		 let formdata= document.getElementById("myform")
		 formdata.submit();
	 }
    
    
     

       //logic for showing booked seat for moviechange and time ended



      //seat booking,display_seat and display_price logic started
      
      
      

     let seatdata= document.getElementsByClassName("seat")

     for(let i=0;i<seatdata.length;i++){
      seatdata[i].addEventListener('click',getSeat)
      
     }
    
  
    function getSeat(e){
      let value=(e.target.value);
      if(seat.includes(value)===false){
        sum=sum+price;
        seat.push(value);
        document.getElementById("seatselected").innerText=seat
        e.target.style.backgroundColor='red'

        console.log(sum)
        document.getElementById("totalprice").innerText=sum
      }
      else if (seat.includes(value)===true)
       {
        let index=seat.indexOf(value)
        seat.splice(index,1)
        sum=sum-price
        console.log(sum)
        document.getElementById("seatselected").innerText=seat
        e.target.style.backgroundColor='green'
        document.getElementById("totalprice").innerText=sum
      }

      
    }

    //seat booking,display_seat and display_price logic  ended


    

      

    
    //start:  storing date and time in an object valuetoSend 
    

    
   // const time= document.getElementById("time")
    //time.addEventListener("change",gettime)

  

   // function gettime(e){
     // valuetoSend['time']=e.target.value
      
   // }
       
      //ended:  storing date and time in an object valuetoSend 



       //submit button action started

      document.getElementById("send").addEventListener("click",storedata)

      function storedata(e){

        
         //  e.preventDefault()
           //storing array to an object
            valuetoSend['seatbooked']=seat;
            
            valuetoSend['totalprice']=sum;
            
           //setting data to corresponding inputfield for sending to  server started
           let seatsendtoserver=document.getElementById("seatbookedtosend")
           seatsendtoserver.value=seat;
          
           let pricesend= document.getElementById("totalpricetosend")
           pricesend.value=sum;
 
         //setting data to corresponding inputfield for sending to  server ended
     
           let movie_name=document.getElementById("moviename").value;
              valuetoSend['moviename']=movie_name
            //to prevent event default function

            //using ajax to send data

       // const xhr=new XMLHttpRequest();
      //xhr.open('POST',`http://localhost:8080/sendbookingdata/${valuetoSend['totalprice']}/${valuetoSend['booking_id']}/${valuetoSend['seatbooked']}`,true);
      //xhr.setRequestHeader("Content-type",'application/json');
      
      const datatoserver=JSON.stringify(valuetoSend);
      console.log(datatoserver)
      xhr.send(datatoserver)


          }
      
      
   //submit button action ended
     



    </script>

     <!-- booking section coding ended -->

     <!-- coding ended -->

     <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
         <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
       </body>
     </html>